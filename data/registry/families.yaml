# data/registry/families.yaml
# ============================================================
# Indicator Family Registry
# ============================================================
# Groups related indicators to prevent double-counting in analysis.
# When the same underlying signal exists at multiple resolutions
# or from multiple sources, this registry ensures PRISM uses
# the appropriate version for each analysis purpose.
#
# Rules:
#   - Only ONE member per family in any single analysis (unless multi-resolution)
#   - Purpose determines which resolution to use
#   - Auto-detection warns if duplicates slip through
# ============================================================

version: "1.0.0"

families:

  # ============================================================
  # EQUITY INDEXES
  # ============================================================

  spx:
    canonical_name: "S&P 500"
    description: "Multi-resolution index family (daily Tiingo, monthly FRED)"
    members:
      sp500_d:
        source: tiingo
        symbol: "^GSPC"
        fred_code: null
        resolution: daily
        frequency: 1d
        history_start: 1928
        use_for:
          - geometry
          - phase
          - short_term_coherence
          - hurst_daily
          - spectral_daily
          - ml_features
        notes: "Primary for geometry and real-time analysis"

      sp500_m:
        source: fred
        symbol: null
        fred_code: "SP500"
        resolution: monthly
        frequency: 1m
        history_start: 1871
        use_for:
          - calibration
          - regime_baseline
          - long_term_hurst
          - historical_validation
          - secular_trends
          - macro_trend
        notes: "150+ years for regime calibration"

    rules:
      default_representation: sp500_d
      allow_multi_resolution: true  # For wavelet analysis
      correlation_warning_threshold: 0.90
      require_single_representation_per_lens: true

  djia:
    canonical_name: "Dow Jones Industrial Average"
    description: "US blue-chip equity index"
    members:
      djia_d:
        source: tiingo
        symbol: "^DJI"
        fred_code: null
        resolution: daily
        frequency: 1d
        history_start: 1896
        use_for:
          - geometry
          - phase
          - cross_index_coherence
        notes: "Longest daily equity history available"

    rules:
      default_representation: djia_d
      allow_multi_resolution: false
      require_single_representation_per_lens: true

  nasdaq:
    canonical_name: "NASDAQ Composite"
    description: "US tech-weighted equity index"
    members:
      nasdaq_d:
        source: tiingo
        symbol: "^IXIC"
        resolution: daily
        history_start: 1971
        use_for:
          - geometry
          - tech_sector_proxy
          - growth_momentum

    rules:
      default_representation: nasdaq_d
      allow_multi_resolution: false

  # ============================================================
  # INTEREST RATES
  # ============================================================

  treasury_10y:
    canonical_name: "10-Year Treasury Yield"
    description: "US government benchmark rate"
    members:
      dgs10_d:
        source: fred
        symbol: null
        fred_code: "DGS10"
        resolution: daily
        frequency: 1d
        history_start: 1962
        use_for:
          - geometry
          - yield_curve
          - real_time_rates

      gs10_m:
        source: fred
        symbol: null
        fred_code: "GS10"
        resolution: monthly
        frequency: 1m
        history_start: 1953
        use_for:
          - calibration
          - long_term_rate_cycles
          - regime_rates

    rules:
      default_representation: dgs10_d
      allow_multi_resolution: true
      correlation_warning_threshold: 0.95
      require_single_representation_per_lens: true

  treasury_2y:
    canonical_name: "2-Year Treasury Yield"
    description: "US short-term government rate"
    members:
      dgs2_d:
        source: fred
        series: "DGS2"
        resolution: daily
        history_start: 1976
        use_for:
          - geometry
          - yield_curve
          - fed_expectations

    rules:
      default_representation: dgs2_d

  # ============================================================
  # VOLATILITY
  # ============================================================

  vix:
    canonical_name: "VIX Volatility Index"
    description: "Market fear gauge"
    members:
      vix_d:
        source: fred
        series: "VIXCLS"
        resolution: daily
        history_start: 1990
        use_for:
          - geometry
          - risk_regime
          - fear_gauge

    rules:
      default_representation: vix_d

  # ============================================================
  # CURRENCY
  # ============================================================

  usd_index:
    canonical_name: "US Dollar Index"
    description: "Trade-weighted dollar strength"
    members:
      dxy_d:
        source: tiingo
        symbol: "DX-Y.NYB"
        resolution: daily
        history_start: 1971
        use_for:
          - geometry
          - currency_regime
          - global_risk

      dtwexb_m:
        source: fred
        series: "DTWEXBGS"
        resolution: monthly
        history_start: 1973
        use_for:
          - calibration
          - long_term_dollar_cycles

    rules:
      default_representation: dxy_d
      allow_multi_resolution: true
      correlation_warning_threshold: 0.85

  # ============================================================
  # COMMODITIES
  # ============================================================

  gold:
    canonical_name: "Gold Price"
    description: "Safe haven commodity"
    members:
      gold_d:
        source: tiingo
        symbol: "GLD"
        resolution: daily
        history_start: 2004
        use_for:
          - geometry
          - safe_haven
        notes: "ETF proxy - liquid but shorter history"

      gold_m:
        source: fred
        series: "GOLDAMGBD228NLBM"
        resolution: daily  # Actually daily from London fix
        history_start: 1968
        use_for:
          - calibration
          - long_term_gold

    rules:
      default_representation: gold_d
      allow_multi_resolution: true

  oil:
    canonical_name: "Crude Oil Price"
    description: "Energy commodity benchmark"
    members:
      oil_d:
        source: tiingo
        symbol: "USO"
        resolution: daily
        history_start: 2006
        use_for:
          - geometry
          - energy_regime
        notes: "ETF proxy"

      wti_d:
        source: fred
        series: "DCOILWTICO"
        resolution: daily
        history_start: 1986
        use_for:
          - calibration
          - oil_shocks

    rules:
      default_representation: wti_d
      allow_multi_resolution: false

# ============================================================
# PURPOSE DEFINITIONS
# ============================================================
# Maps analysis purposes to preferred resolutions

purpose_resolution_map:
  # Real-time / high-frequency analysis
  geometry: daily
  phase_analysis: daily
  short_term_coherence: daily
  spectral_daily: daily
  hurst_daily: daily

  # Historical / calibration analysis
  calibration: monthly
  regime_baseline: monthly
  historical_validation: monthly
  long_term_hurst: monthly
  secular_trends: monthly

  # Special cases
  wavelet: multi  # Explicitly uses both
  cross_resolution: multi

# ============================================================
# GLOBAL RULES
# ============================================================

global_rules:
  # Default behavior when family member not specified
  default_to_highest_resolution: true

  # Correlation threshold for duplicate warning
  duplicate_correlation_threshold: 0.90

  # Whether to auto-select based on purpose
  auto_select_by_purpose: true

  # Log warnings when potential duplicates detected
  warn_on_potential_duplicates: true

  # Block analysis if duplicates detected (strict mode)
  block_on_duplicates: false
